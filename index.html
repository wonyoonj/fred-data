<!DOCTYPE html>
<html lang="ko">
<head>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml">
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3939948593689554"
     crossorigin="anonymous"></script>
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">
    <meta name="naver-site-verification" content="3c5e34898f2cef35432619edafb1d9362ab55063" />
    <meta name="google-site-verification" content="_jcjvlFGv3HiGbo85WZ6IU_dfDIQx2j2JH0k5uMHq7U" />
    <title>원뎅이의 미국 통화 유동성 현황</title>
    <meta name="title" content="원뎅이의 미국 통화 유동성 현황">
    <meta name="subject" content="실시간 지표 데이터를 통해, 현재 미국 시장의 통화 유동성 흐름을 한눈에 파악해보세요!">
    <meta name="description" content="미국의 FED, 정부, MMF, 시장 간의 유동성 흐름을 애니메이션으로 한눈에 시각화하여 보여줍니다.">
    <meta name="keywords" content="미국, FED, 연준, 정부, MMF, 시장, 관세, 유동성, 역레포, 금리, 긴축, 양적완화, TGA잔고, SOFR, EFFR, 국채금리, 나스닥, S&P500, M2, M1, 지금준비금, 실시간, 트럼프, 파월, 베센트">

    <meta property="og:type" content="website">
    <meta property="og:title" content="원뎅이의 미국 통화 유동성 현황">
    <meta property="og:description" content="미국의 FED, 정부, MMF, 시장, 관세 간의 유동성 흐름을 애니메이션으로 한눈에 시각화하여 보여줍니다.">
    <meta property="og:image" content="https://americayoudongsung.netlify.app/icon/government.JPG">
    <meta property="og:url" content="https://americayoudongsung.netlify.app/">

    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Arial', sans-serif; margin: 0; padding: 0; background: #f4f4f4; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; position: relative; min-height: 100vh; }
        .header { text-align: center; padding: 10px; background: #007bff; color: white; }
        .back-btn { position: absolute; top: 10px; left: 10px; background: none; border: none; cursor: pointer; font-size: 24px; font-weight: bold; color: black; width: 30px; text-align: center; }
        .back-btn::before { content: "◄"; font-size: 36px; }
        .info-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; cursor: pointer; font-size: 20px; }
        .button { padding: 10px 20px; background: #0056b3; color: white; border: none; cursor: pointer; } /* ACCESSIBILITY: Increased contrast */
        .button:hover { background: #004494; }

        .page-title {
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 35px;
            font-weight: bold;
            color: black;
        }
        
        .source-credit-main {
            position: absolute;
            top: 45px;
            right: 15px;
            font-size: 12px;
            font-weight: bold;
            color: #555;
        }

        #liquidityFlow, #interestRateFlow {
            text-align: center;
            padding: 20px;
            position: relative;
            height: 650px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        #liquidityFlow .icon-container, #interestRateFlow .icon-container {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
        }
        #liquidityFlow .icon, #interestRateFlow .icon {
            width: 80px;
            height: 80px;
            display: block;
            object-fit: contain;
        }
        #liquidityFlow .icon-label, #interestRateFlow .icon-label {
            font-weight: bold;
            color: black;
            font-size: 14px;
            white-space: nowrap;
            margin-top: 5px;
        }

        .FED-container .icon-label {
            order: -1;
            margin-bottom: 5px;
            margin-top: 0;
        }

        .FED-container { top: 20%; left: 50%; }
        .Government-container { top: 57%; left: 20%; }
        .Market-container { top: 90%; left: 50%; }
        .MMF-container { top: 57%; left: 80%; }

        #tgaSlopeDisplay, #fedLiquidityDisplay, #mmfToRrpDisplay, #mmfToMarketDisplay,
        #tb3msRateDisplay_interest, #rrpRateDisplay_interest, #effrRateDisplay_interest, #sofrRateDisplay_interest,
        #tb1yrRateDisplay_interest, #discountRateDisplay_interest, #tb10yrRateDisplay_interest {
            position: absolute;
            transform: translateX(-50%);
            font-size: 0.85em; /* ACCESSIBILITY: Slightly increased font size */
            font-weight: bold;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            padding: 3px 6px;
            border-radius: 5px;
            border: 1px solid #ccc;
            text-align: center;
        }
        
        #netMarketFlowDisplay, #netMarketFlowDisplay_interest {
            display: inline-block;
            top: -40%;
            left: 50%;
            background: none;
            border: none;
            font-size: 0.9em;
            min-width: 200px;
        }

        .popup-container {
            position: absolute;
            z-index: 20;
        }

        .popup-container:hover {
            z-index: 30;
        }
        
        .tga-popup-container {
            top: calc(60% + 40px + 5px);
            left: 30%;
            transform: translateX(-50%);
        }
        
        .tga-popup-container-1yr {
            top: calc(60% + 40px + 5px + 50px);
            left: 30%;
            transform: translateX(-50%);
        }

        .tga-popup-container-10yr {
            top: calc(60% + 40px + 5px + 100px);
            left: 30%;
            transform: translateX(-50%);
        }

        .fed-popup-container {
            top: calc(38% - 40px - 10px);
            left: 45%;
            transform: translateX(-50%);
        }

        .fed-popup-container-discount {
            top: calc(38% - 40px - 10px);
            left: 63%;
            transform: translateX(-50%);
        }
        
        .mmf-fed-popup-container {
            top: calc(50% - 40px - 10px);
            left: 80%;
            transform: translateX(-50%);
        }

        .mmf-market-popup-container {
            top: calc(63% + 40px);
            left: 80%;
            transform: translateX(-50%);
        }

        .tooltip-container {
            visibility: hidden;
            background-color: #555;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 9999;
            bottom: 100%;
            left: 50%;
            margin-left: -100px;
            width: 180px;
            opacity: 0;
            transition: opacity 0.3s;
            line-height: 1.5;
            white-space: normal;
        }
        
        .fed-popup-container .tooltip-container,
        .fed-popup-container-discount .tooltip-container,
        .mmf-fed-popup-container .tooltip-container {
            bottom: auto;
            top: 100%;
            margin-top: 10px;
        }

        .tooltip-container p {
            margin-top: 0;
            margin-bottom: 5px;
            font-size: 13px; /* ACCESSIBILITY: Slightly increased font size */
            font-weight: normal;
        }

        .tooltip-container .graph-btn {
            background: #009688;
            color: white;
            border: none;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 3px;
        }

        .tooltip-container .update-date {
            font-size: 10px;
            color: #ccc;
            text-align: right;
            margin-top: 10px;
            display: block;
        }
        
        .tooltip-container::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }
        
        .fed-popup-container .tooltip-container::after,
        .fed-popup-container-discount .tooltip-container::after,
        .mmf-fed-popup-container .tooltip-container::after {
            top: auto;
            bottom: 100%;
            border-color: transparent transparent #555 transparent;
        }

        .liquidity-tga-popup:hover .tooltip-container { margin-left: -150px; }
        .liquidity-fed-popup:hover .tooltip-container { margin-left: -150px; top: 25px; width: 250px; }
        .liquidity-mmf-fed-popup:hover .tooltip-container { margin-left: -220px; top: 25px; width: 250px; }
        .liquidity-mmf-market-popup:hover .tooltip-container { margin-left: -220px; width: 280px; }
        .interest-tb3ms-popup:hover .tooltip-container { margin-left: -150px; }
        .interest-tb1yr-popup:hover .tooltip-container { margin-left: -150px; }
        .interest-tb10yr-popup:hover .tooltip-container { margin-left: -150px; }
        .interest-rrp-rate-popup:hover .tooltip-container { margin-left: -200px; top: 25px; width: 250px; }
        .interest-discount-rate-popup:hover .tooltip-container { margin-left: -200px; top: 25px; width: 250px; }
        .interest-effr-rate-popup:hover .tooltip-container { margin-left: -200px; top: 25px; width: 250px; }
        .interest-sofr-rate-popup:hover .tooltip-container { margin-left: -200px; width: 280px; }
        
        .popup-container:hover .tooltip-container {
            visibility: visible;
            opacity: 1;
        }

        #tgaSlopeDisplay, #fedLiquidityDisplay, #mmfToRrpDisplay, #mmfToMarketDisplay,
        #tb3msRateDisplay_interest, #rrpRateDisplay_interest, #effrRateDisplay_interest, #sofrRateDisplay_interest,
        #tb1yrRateDisplay_interest, #discountRateDisplay_interest, #tb10yrRateDisplay_interest {
            position: relative;
            z-index: 10;
            cursor: help;
        }
        
        .slope-positive { color: rgb(222, 3, 3); } /* ACCESSIBILITY: Increased contrast */
        .slope-negative { color: #729fff; } /* ACCESSIBILITY: Increased contrast */

        .dollar-animated-object {
            position: absolute;
            object-fit: contain;
            opacity: 0;
            z-index: 5;
        }

        @keyframes dollarFlowToMarket {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 20%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 20%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 90%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 90%; }
        }
        @keyframes dollarFlowToFED {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 90%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 90%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 20%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 20%; }
        }
        @keyframes dollarFlowToGovernment {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 90%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 90%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 20%; top: 57%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 20%; top: 57%; }
        }
        @keyframes dollarFlowFromGovernment {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 20%; top: 57%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 20%; top: 57%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 90%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 90%; }
        }
        @keyframes dollarFlowFromMmfToFed {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 57%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 57%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 20%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 20%; }
        }
        @keyframes dollarFlowFromFedToMmf {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 20%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 20%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 57%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 57%; }
        }
        @keyframes dollarFlowFromMmfToMarket_parabolic {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 57%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 57%; }
            50% { transform: translate(-50%, -50%) scale(1) translateY(50px); opacity: 1; left: 65%; top: 75%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 90%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 90%; }
        }
        @keyframes dollarFlowFromMarketToMmf_parabolic {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 90%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 90%; }
            50% { transform: translate(-50%, -50%) scale(1) translateY(50px); opacity: 1; left: 65%; top: 75%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 57%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 57%; }
        }
        @keyframes dollarFlowFromMmfToGovernment {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 57%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 57%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 20%; top: 57%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 20%; top: 57%; }
        }
        @keyframes dollarFlowFromGovernmentToMmf {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 20%; top: 57%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 20%; top: 57%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 57%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 57%; }
        }

        .animated-dollar-to-market { animation: dollarFlowToMarket var(--animation-duration) linear forwards; }
        .animated-dollar-to-fed { animation: dollarFlowToFED var(--animation-duration) linear forwards; }
        .animated-dollar-to-government { animation: dollarFlowToGovernment var(--animation-duration) linear forwards; }
        .animated-dollar-from-government { animation: dollarFlowFromGovernment var(--animation-duration) linear forwards; }
        .animated-dollar-from-mmf-to-fed { animation: dollarFlowFromMmfToFed var(--animation-duration) linear forwards; }
        .animated-dollar-from-fed-to-mmf { animation: dollarFlowFromFedToMmf var(--animation-duration) linear forwards; }
        .animated-dollar-from-mmf-to-market_parabolic { animation: dollarFlowFromMmfToMarket_parabolic var(--animation-duration) linear forwards; }
        .animated-dollar-from-market-to-mmf_parabolic { animation: dollarFlowFromMarketToMmf_parabolic var(--animation-duration) linear forwards; }

        #graphIndicators { padding: 20px; text-align: center; }
        .indicator-section { margin-bottom: 20px; }
        .indicator-section h3 { font-size: 18px; margin-bottom: 10px; color: #007bff; }
        .indicator-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        #graphPage {
            text-align: center;
            padding: 20px;
            height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
        }
        #graphPage canvas {
            max-width: 100%;
            width: 100%;
            height: 400px;
            cursor: grab;
            flex-grow: 1;
        }

        #graphDataSource {
            position: absolute;
            top: 70px;
            right: 25px;
            font-size: 12px;
            color: #666;
            background-color: rgba(240, 240, 240, 0.8);
            padding: 2px 5px;
            border-radius: 3px;
            z-index: 10;
        }

        #infoPage { padding: 20px; text-align: center; }
        .time-buttons { margin: 10px 0; display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; }
        .time-btn { padding: 5px 10px; background: #e9ecef; border: 1px solid #ced4da; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: background-color 0.2s; }
        .time-btn:hover { background-color: #dee2e6; }
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #0056b3; padding: 10px; display: flex; justify-content: space-around; } /* ACCESSIBILITY: Increased contrast */

        @media (max-width: 600px) {
            .container { padding: 10px; }
            .back-btn { top: 5px; left: 5px; }
            .info-btn { top: 5px; right: 5px; }
            .page-title {
                font-size: 24px;
                top: 5px;
                left: 10px;
            }
            .source-credit-main {
                top: 47px;
                right: 10px;
                font-size: 10px;
            }
            #liquidityFlow .icon, #interestRateFlow .icon { width: 60px; height: 60px; }
            #liquidityFlow .icon-label, #interestRateFlow .icon-label { font-size: 12px; }

            .FED-container { top: 15%; left: 50%; }
            .Government-container { top: 47%; left: 15%; }
            .Market-container { top: 80%; left: 50%; }
            .MMF-container { top: 47%; left: 85%; }

            #netMarketFlowDisplay, #netMarketFlowDisplay_interest {
                top: -45%;
                min-width: 150px;
            }
            
            #tgaSlopeDisplay, #fedLiquidityDisplay, #mmfToRrpDisplay, #mmfToMarketDisplay,
            #tb3msRateDisplay_interest, #rrpRateDisplay_interest, #effrRateDisplay_interest, #sofrRateDisplay_interest,
            #tb1yrRateDisplay_interest, #discountRateDisplay_interest, #tb10yrRateDisplay_interest {
                font-size: 0.7em;
                padding: 2px 4px;
                white-space: normal;
            }
            
            #mmfToRrpDisplay, #mmfToMarketDisplay,
            #effrRateDisplay_interest, #sofrRateDisplay_interest {
                width: 90px;
            }
            
            .tga-popup-container {
                top: calc(47% + 30px + 12px);
                left: 28%;
            }
            .tga-popup-container-1yr {
                 top: calc(47% + 30px + 12px + 45px);
                 left: 28%;
            }
            .tga-popup-container-10yr {
                 top: calc(47% + 30px + 12px + 90px);
                 left: 28%;
            }

            .fed-popup-container { 
                top: calc(28% - 30px - 5px);
                left: 42%;
            }
            .fed-popup-container-discount {
                top: calc(28% - 30px - 5px);
                left: 65%;
            }
            .mmf-fed-popup-container { 
                top: calc(32%);
                left: 85%;
            }
            .mmf-market-popup-container { 
                top: calc(55%);
                left: 85%;
            }

            .tooltip-container {
                margin-left: -100px;
                width: 200px;
            }

            .liquidity-tga-popup:hover .tooltip-container { width: 200px; left: 30%; margin-left: -90px; }
            .liquidity-fed-popup:hover .tooltip-container { width: 250px; }
            .liquidity-mmf-fed-popup:hover .tooltip-container { width: 200px; }
            .liquidity-mmf-market-popup:hover .tooltip-container { width: 200px; }
            .interest-tb3ms-popup:hover .tooltip-container { width: 200px; left: 30%; margin-left: -90px; }
            .interest-tb1yr-popup:hover .tooltip-container { width: 200px; left: 30%; margin-left: -90px; }
            .interest-tb10yr-popup:hover .tooltip-container { width: 200px; left: 30%; margin-left: -90px; }
            .interest-rrp-rate-popup:hover .tooltip-container { width: 200px; left: 30%; margin-left: -100px; }
            .interest-discount-rate-popup:hover .tooltip-container { width: 250px; }
            .interest-effr-rate-popup:hover .tooltip-container { width: 200px; }
            .interest-sofr-rate-popup:hover .tooltip-container { width: 200px; }
            
            .dollar-animated-object { width: 22.5px; height: 22.5px; }

            @keyframes dollarFlowToMarket {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 15%; }
                20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 15%; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
                100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
            }
            @keyframes dollarFlowToFED {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
                20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 15%; }
                100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 15%; }
            }
            @keyframes dollarFlowToGovernment {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
                20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 15%; top: 47%; }
                100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 15%; top: 47%; }
            }
            @keyframes dollarFlowFromGovernment {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 15%; top: 47%; }
                20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 15%; top: 47%; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
                100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
            }
            @keyframes dollarFlowFromMmfToFed {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 85%; top: 47%; }
                20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 85%; top: 47%; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 15%; }
                100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 15%; }
            }
            @keyframes dollarFlowFromFedToMmf {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 15%; }
                20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 15%; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 85%; top: 47%; }
                100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 85%; top: 47%; }
            }
            @keyframes dollarFlowFromMmfToMarket_parabolic {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 85%; top: 47%; }
                20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 85%; top: 47%; }
                50% { transform: translate(-50%, -50%) scale(1) translateY(25px); opacity: 1; left: 67.5%; top: 68%; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
                100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
            }
            @keyframes dollarFlowFromMarketToMmf_parabolic {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
                20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
                50% { transform: translate(-50%, -50%) scale(1) translateY(25px); opacity: 1; left: 67.5%; top: 68%; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 85%; top: 47%; }
                100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 85%; top: 47%; }
            }
            @keyframes dollarFlowFromMmfToGovernment {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 85%; top: 47%; }
                20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 85%; top: 47%; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 15%; top: 47%; }
                100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 15%; top: 47%; }
            }
            @keyframes dollarFlowFromGovernmentToMmf {
                0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 15%; top: 47%; }
                20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 15%; top: 47%; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 57%; }
                100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 57%; }
            }

            .indicator-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 5px;
                max-width: 100%;
            }
            .indicator-buttons .button {
                border: 1px solid black;
                width: 95%;
                margin: 5px auto;
            }

            .button { margin: 5px 0; }
            .time-buttons { justify-content: space-around; }
            .time-btn {
                padding: 5px 8px;
                font-size: 0.85em;
                margin: 2px;
                flex-basis: auto;
                width: auto;
            }
            #graphPage canvas {
                width: 100%;
                height: 300px;
            }
            #graphDataSource {
                top: 55px;
                right: 15px;
                font-size: 10px;
            }
            .nav-bar { padding: 5px; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns" defer></script>
</head>
<body>
    <div class="container">
        
        <div id="liquidityFlow" class="page">
            <h1 class="page-title">원뎅이의 미국 통화 유동성 현황</h1>
            <div class="source-credit-main">자료 출처: FRED, Office of Financial Research (OFR)</div>
            
            <div class="tga-popup-container popup-container liquidity-tga-popup">
                <div id="tgaSlopeDisplay"></div>
                <div class="tooltip-container" id="tga-tooltip-content">
                </div>
            </div>
            
            <div class="fed-popup-container popup-container liquidity-fed-popup">
                <div id="fedLiquidityDisplay"></div>
                <div class="tooltip-container" id="fed-tooltip-content">
                </div>
            </div>

            <div class="mmf-fed-popup-container popup-container liquidity-mmf-fed-popup">
                <div id="mmfToRrpDisplay"></div>
                <div class="tooltip-container" id="mmf-fed-tooltip-content">
                </div>
            </div>

            <div class="mmf-market-popup-container popup-container liquidity-mmf-market-popup">
                <div id="mmfToMarketDisplay"></div>
                <div class="tooltip-container" id="mmf-market-tooltip-content">
                </div>
            </div>
            
            <div class="icon-container FED-container">
                <span class="icon-label">중앙은행 FED</span>
                <img src="./icon/fed.jpg" alt="FED" class="icon">
            </div>
            <div class="icon-container Government-container">
                <img src="./icon/government.JPG" alt="Government TGA" class="icon">
                <span class="icon-label">미국 정부</span>
            </div>
            <div class="icon-container Market-container">
                <img src="./icon/Market.jpg" alt="Market" class="icon">
                <span class="icon-label">미국 시장(Market)</span>
                <div id="netMarketFlowDisplay"></div>
                </div>
            <div class="icon-container MMF-container">
                <img src="./icon/MMF.jpg" alt="MMF" class="icon">
                <span class="icon-label">MMF<br>(Money Market Fund)</span>
            </div>
        </div>

        <div id="interestRateFlow" class="page" style="display:none;">

            <div class="page-title">원뎅이의 미국 통화 유동성 현황</div>
            <div class="source-credit-main">자료 출처: FRED</div>

            <div class="tga-popup-container popup-container interest-tb3ms-popup">
                <div id="tb3msRateDisplay_interest"></div>
                <div class="tooltip-container" id="tb3ms-tooltip-content_interest"></div>
            </div>
            
            <div class="tga-popup-container-1yr popup-container interest-tb1yr-popup">
                <div id="tb1yrRateDisplay_interest"></div>
                <div class="tooltip-container" id="tb1yr-tooltip-content_interest"></div>
            </div>

            <div class="tga-popup-container-10yr popup-container interest-tb10yr-popup">
                <div id="tb10yrRateDisplay_interest"></div>
                <div class="tooltip-container" id="tb10yr-tooltip-content_interest"></div>
            </div>
            
            <div class="fed-popup-container popup-container interest-rrp-rate-popup">
                <div id="rrpRateDisplay_interest"></div>
                <div class="tooltip-container" id="rrp-rate-tooltip-content_interest"></div>
            </div>

            <div class="fed-popup-container-discount popup-container interest-discount-rate-popup">
                <div id="discountRateDisplay_interest"></div>
                <div class="tooltip-container" id="discount-rate-tooltip-content_interest"></div>
            </div>

            <div class="mmf-fed-popup-container popup-container interest-effr-rate-popup">
                <div id="effrRateDisplay_interest"></div>
                <div class="tooltip-container" id="effr-rate-tooltip-content_interest"></div>
            </div>

            <div class="mmf-market-popup-container popup-container interest-sofr-rate-popup">
                <div id="sofrRateDisplay_interest"></div>
                <div class="tooltip-container" id="sofr-rate-tooltip-content_interest"></div>
            </div>
            
            <div class="icon-container FED-container">
                <span class="icon-label">중앙은행 FED</span>
                <img src="./icon/fed.jpg" alt="FED" class="icon">
            </div>
            <div class="icon-container Government-container">
                <img src="./icon/government.JPG" alt="Government TGA" class="icon">
                <span class="icon-label">미국 정부</span>
            </div>
            <div class="icon-container Market-container">
                <img src="./icon/Market.jpg" alt="Market" class="icon">
                <span class="icon-label">미국 시장(Market)</span>
                <div id="netMarketFlowDisplay_interest"></div>
                </div>
            <div class="icon-container MMF-container">
                <img src="./icon/MMF.jpg" alt="MMF" class="icon">
                <span class="icon-label">시중은행(Bank)</span>
            </div>
        </div>

        <div id="graphIndicators" class="page" style="display:none;">
            <div class="indicator-section">
                <h3>미국 자금 현황</h3>
                <div class="indicator-buttons">
                    <button class="button" onclick="showGraph('WTREGEN')">미 정부 TGA 잔고</button>
                    <button class="button" onclick="showGraph('WRESBAL')">미 은행 지급준비금</button>
                    <button class="button" onclick="showGraph('RRPONTSYD')">연준 역레포 자금</button>
                    <button class="button" onclick="showGraph('MMMFFAQ027S')">MMF 잔고</button>
                    <button class="button" onclick="showGraph('WALCL')">연준 전체 자산 + 부채</button>
                </div>
            </div>
            <div class="indicator-section">
                <h3>금리</h3>
                <div class="indicator-buttons">
                    <button class="button" onclick="showGraph('TB3MS')">3개월 미 국채금리</button>
                    <button class="button" onclick="showGraph('TB1YR')">1년물 미 국채금리</button>
                    <button class="button" onclick="showGraph('DGS10')">10년물 미 국채금리</button>
                    <button class="button" onclick="showGraph('SOFR')">SOFR 금리</button>
                    <button class="button" onclick="showGraph('FEDFUNDS')">EFFR 금리</button>
                    <button class="button" onclick="showGraph('IORB')">IORB 금리</button>
                    <button class="button" onclick="showGraph('RRPONTSYAWARD')">역레포 금리</button>
                    <button class="button" onclick="showGraph('DPCREDIT')">연준 할인율</button>
                    <button class="button" onclick="showGraph('DRBLACBS')">미 은행 연체율(전체)</button>
                    <button class="button" onclick="showGraph('SOFR_FEDFUNDS_SPREAD')">SOFR, EFFR 스프레드</button>
                    <button class="button" onclick="showGraph('SOFR_IORB_SPREAD')">SOFR, IORB 스프레드</button>
                </div>
            </div>
            <div class="indicator-section">
                <h3>유동성</h3>
                <div class="indicator-buttons">
                    <button class="button" onclick="showGraph('M2SL')">M2</button>
                    <button class="button" onclick="showGraph('M1SL')">M1</button>
                </div>
            </div>
            <div class="indicator-section">
                <h3>자산 가격</h3>
                <div class="indicator-buttons">
                    <button class="button" onclick="showGraph('NASDAQ100')">나스닥100 지수</button>
                    <button class="button" onclick="showGraph('SP500')">S&P500 지수</button>
                    <button class="button" onclick="showGraph('SP500_MCAP')">S&P500 시가총액</button>
                </div>
            </div>
            <div class="indicator-section">
                <h3>선행지표</h3>
                <div class="indicator-buttons">
                    <button class="button" onclick="showGraph('ALTSALES')">자동차, 트럭 판매량</button>
                    <button class="button" onclick="showGraph('HOUST')">주택 착공 허가 건수</button>
                    <button class="button" onclick="showGraph('DCOILBRENTEU')">국제 유가</button>
                </div>
            </div>
        </div>

        <div id="graphPage" class="page" style="display:none;">
            <button class="back-btn" onclick="showGraphIndicators()">◄</button>
            <button class="info-btn" onclick="showInfo()">Info</button>
            <h2 id="graphTitle"></h2>
            <div id="graphDataSource"></div>
            <canvas id="myChart"></canvas>
            <div class="time-buttons">
                <button class="time-btn" onclick="updateChart('1M')">1M</button>
                <button class="time-btn" onclick="updateChart('6M')">6M</button>
                <button class="time-btn" onclick="updateChart('1Y')">1Y</button>
                <button class="time-btn" onclick="updateChart('5Y')">5Y</button>
                <button class="time-btn" onclick="updateChart('10Y')">10Y</button>
                <button class="time-btn" onclick="updateChart('All')">All</button>
            </div>
        </div>

        <div id="infoPage" class="page" style="display:none;">
            <button class="back-btn" onclick="goBackToGraph()">◄</button>
            <h2 id="infoTitle"></h2>
            <div id="infoContent"></div>
        </div>

        <div class="nav-bar">
            <button class="button" onclick="showLiquidityFlow()">유동성 현황</button>
            <button class="button" onclick="showInterestRateFlow()">금리 현황</button>
            <button class="button" onclick="showGraphIndicators()">그래프 지표</button>
        </div>
    </div>

    <script>
        let myChart = null;
        let isDragging = false;
        let startX;
        let startScrollX;
        let currentIndicator = null;
        let currentGraphData = [];
        let dollarAnimationIntervals = [];
        
        const BASE_ANIMATION_DURATION = 3000;
        const BASE_DOLLAR_SIZE = 37.5; 
        const NUM_DOLLAR_ANIMATIONS = 3;

        const FUNCTION_BASE_URL = '/.netlify/functions/get-csv-data';
        
        const dataCache = new Map();
        const CACHE_TTL = 3600 * 1000; // 1 hour in milliseconds

        async function fetchAndCacheData(indicator) {
            if (dataCache.has(indicator)) {
                const { data, timestamp } = dataCache.get(indicator);
                if (Date.now() - timestamp < CACHE_TTL) {
                    return Promise.resolve(data);
                }
            }
            const functionUrl = `${FUNCTION_BASE_URL}?indicator=${indicator}`;
            try {
                const response = await fetch(functionUrl);
                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(`'${indicatorTitles[indicator] || indicator}' 데이터를 찾을 수 없거나 불러오지 못했어요! (${response.status}: ${errorBody.error || response.statusText})`);
                }
                const text = await response.text();
                const parsedData = await parseCSV(text);
                if (parsedData.length > 0) {
                    parsedData.sort((a, b) => new Date(a.date) - new Date(b.date));
                    dataCache.set(indicator, { data: parsedData, timestamp: Date.now() });
                }
                return parsedData;
            } catch (error) {
                 console.error(`Failed to fetch ${indicator}:`, error);
                 throw error;
            }
        }

        const indicatorTitles = {
            'WTREGEN': '미 정부 TGA 잔고', 'WRESBAL': '미 은행 지급준비금', 'RRPONTSYD': '연준 역레포 자금', 'MMMFFAQ027S': 'MMF 잔고', 'WALCL': '연준 전체 자산 + 부채',
            'SOFR': 'SOFR 금리', 'FEDFUNDS': 'EFFR 금리', 'IORB': 'IORB 금리', 'TB3MS': '3개월 미 국채금리', 'TB1YR': '1년물 미 국채금리', 'DGS10': '10년물 미 국채금리', 'DPCREDIT': '연준 할인율',
            'DRBLACBS': '미 은행 연체율(전체)', 'M2SL': 'M2', 'M1SL': 'M1', 'NASDAQ100': '나스닥100 지수', 'SP500': 'S&P500 지수', 'SP500_MCAP': 'S&P500 시가총액',
            'RRPONTSYAWARD': '역레포 금리', 'ALTSALES': '자동차, 트럭 판매량', 'HOUST': '주택 착공 허가 건수', 'DCOILBRENTEU': '국제 유가',
            'SOFR_FEDFUNDS_SPREAD': 'SOFR, EFFR 스프레드', 'SOFR_IORB_SPREAD': 'SOFR, IORB 스프레드'
        };

        const indicatorUnits = {
            'WTREGEN': 'Billions of U.S. Dollars', 'WRESBAL': 'Billions of Dollars', 'RRPONTSYD': 'Billions of Dollars', 'MMMFFAQ027S': 'Billions of Dollars', 'WALCL': 'Billions of Dollars',
            'M2SL': 'Billions of Dollars', 'M1SL': 'Billions of Dollars', 'SP500_MCAP': 'Billions of Dollars', 'SOFR': 'Percent (%)', 'FEDFUNDS': 'Percent (%)', 'IORB': 'Percent (%)', 'TB3MS': 'Percent (%)',
            'TB1YR': 'Percent (%)', 'DGS10': 'Percent (%)', 'DPCREDIT': 'Percent (%)', 'DRBLACBS': 'Percent (%)', 'NASDAQ100': 'Index', 'SP500': 'Index',
            'RRPONTSYAWARD': 'Percent (%)', 'ALTSALES': 'Millions of Units', 'HOUST': 'Thousands of Units', 'DCOILBRENTEU': 'Dollars per Barrel',
            'SOFR_FEDFUNDS_SPREAD': 'Percent (%)', 'SOFR_IORB_SPREAD': 'Percent (%)'
        };
        
        const spreadConfigs = {
            'SOFR_FEDFUNDS_SPREAD': [
                { code: 'SOFR', label: 'SOFR', color: '#007bff' },
                { code: 'FEDFUNDS', label: 'EFFR', color: 'red' }
            ],
            'SOFR_IORB_SPREAD': [
                { code: 'SOFR', label: 'SOFR', color: '#007bff' },
                { code: 'IORB', label: 'IORB', color: 'red' }
            ]
        };

        async function parseCSV(text) {
            const lines = text.trim().split('\n');
            if (lines.length <= 1) return [];
            const headers = lines[0].split(',').map(h => h.trim());
            let dateColIndex = headers.findIndex(h => h.toLowerCase() === 'date' || h.toLowerCase() === 'data');
            const valueColName = headers.find((h, i) => i !== dateColIndex);
            const valueColIdx = headers.indexOf(valueColName);
            if (dateColIndex === -1 || valueColIdx === -1) return [];
            const parsedData = [];
            for (let i = 1; i < lines.length; i++) {
                const columns = lines[i].split(',');
                if (columns.length > Math.max(dateColIndex, valueColIdx)) {
                    const dateStr = columns[dateColIndex].trim();
                    const valueStr = columns[valueColIdx].trim();
                    const dateObj = new Date(dateStr);
                    const valueNum = parseFloat(valueStr);
                    if (!isNaN(dateObj.getTime()) && !isNaN(valueNum) && valueStr !== '.') {
                        parsedData.push({ date: dateStr, value: valueNum });
                    }
                }
            }
            return parsedData;
        }

        window.addEventListener('load', () => showPage('liquidityFlow'));

        const pages = ['liquidityFlow', 'interestRateFlow', 'graphIndicators', 'graphPage', 'infoPage'];
        function showPage(pageId) {
            pages.forEach(id => document.getElementById(id).style.display = id === pageId ? 'block' : 'none');
            if (pageId === 'liquidityFlow') { updateLiquidityFlowAnimation(); } 
            else if (pageId === 'interestRateFlow') { updateInterestRateFlowData(); stopLiquidityFlowAnimation(); }
            else { stopLiquidityFlowAnimation(); }
        }

        function showLiquidityFlow() { showPage('liquidityFlow'); }
        function showInterestRateFlow() { showPage('interestRateFlow'); }
        function showGraphIndicators() { showPage('graphIndicators'); }

        async function showGraph(indicator) {
            currentIndicator = indicator;
            showPage('graphPage');
            document.getElementById('graphTitle').textContent = indicatorTitles[indicator] || indicator;
            document.getElementById('graphDataSource').textContent = (indicator === 'SP500_MCAP') ? '자료 출처: https://ycharts.com' : '자료 출처: FRED';
            
            try {
                renderErrorMessage("데이터를 불러오는 중...");
                
                const isSpread = spreadConfigs.hasOwnProperty(indicator);

                if (isSpread) {
                    const configs = spreadConfigs[indicator];
                    const dataPromises = configs.map(config => fetchAndCacheData(config.code));
                    const datasetsRaw = await Promise.all(dataPromises);

                    currentGraphData = datasetsRaw.map((data, index) => {
                        const config = configs[index];
                        return {
                            label: config.label,
                            borderColor: config.color,
                            data: data.map(item => ({ x: item.date, y: item.value })),
                            fill: false, tension: 0.1, pointRadius: 0
                        };
                    });
                } else {
                    let data = await fetchAndCacheData(indicator);
                    if (data.length === 0) {
                        renderErrorMessage(`'${indicatorTitles[indicator]}' 지표의 유효한 데이터가 없어요.`);
                        return;
                    }
                    let processedData = data.map(item => {
                        let value = item.value;
                        if (indicator === 'WALCL') value /= 1000;
                        else if (indicator === 'MMMFFAQ027S' || indicator === 'SP500_MCAP') value /= 1000000000;
                        return { x: item.date, y: value };
                    });

                    currentGraphData = [{
                        label: indicatorTitles[indicator] || indicator,
                        data: processedData,
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        fill: false, tension: 0.1, pointRadius: 0
                    }];
                }
                
                updateChart('All');

            } catch (error) {
                renderErrorMessage(`'${indicatorTitles[indicator]}' 그래프를 그릴 수 없어요! 오류: ${error.message}`);
            }
        }
        
        function renderChart(indicator, datasets) {
            const ctx = document.getElementById('myChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        x: { type: 'time', time: { unit: 'month', tooltipFormat: 'yyyy-MM-dd', displayFormats: { day: 'yyyy-MM-dd', month: 'yyyy-MM', year: 'yyyy' }}, title: { display: true, text: 'Date' }},
                        y: { title: { display: true, text: indicatorUnits[indicator] || 'Value', font: { weight: 'bold' }}, ticks: { callback: value => {
                            if (Math.abs(value) >= 1e12) return (value / 1e12) + 'T'; if (Math.abs(value) >= 1e9) return (value / 1e9) + 'B';
                            if (Math.abs(value) >= 1e6) return (value / 1e6) + 'M'; if (Math.abs(value) >= 1e3) return (value / 1e3) + 'K';
                            return value;
                        }}}
                    },
                    plugins: { legend: { display: true }, tooltip: { mode: 'index', intersect: false } },
                    onHover: (event, chartElement) => { event.native.target.style.cursor = chartElement.length ? 'grab' : 'default'; }
                }
            });
            const canvas = document.getElementById('myChart');
            canvas.onmousedown = startDragging; canvas.onmousemove = drag; canvas.onmouseup = stopDragging;
            canvas.onmouseleave = stopDragging; canvas.onwheel = zoomChart;
        }

        function updateChart(range) {
            if (!currentGraphData || currentGraphData.length === 0) return;
            
            let datasetsToShow = JSON.parse(JSON.stringify(currentGraphData)); // Deep copy
            let hasData = false;

            if (range !== 'All') {
                const lastDate = new Date(Math.max(...datasetsToShow.flatMap(ds => ds.data.map(d => new Date(d.x).getTime()))));
                if (!isNaN(lastDate.getTime())) {
                    const cutoff = new Date(lastDate);
                    if (range === '1M') cutoff.setMonth(lastDate.getMonth() - 1);
                    else if (range === '6M') cutoff.setMonth(lastDate.getMonth() - 6);
                    else cutoff.setFullYear(lastDate.getFullYear() - { '1Y': 1, '5Y': 5, '10Y': 10 }[range]);
                    
                    datasetsToShow.forEach(ds => {
                        ds.data = ds.data.filter(item => new Date(item.x) >= cutoff);
                    });
                }
            }

            hasData = datasetsToShow.some(ds => ds.data.length > 0);

            if (hasData) {
                renderChart(currentIndicator, datasetsToShow);
            } else {
                renderErrorMessage('해당 기간의 데이터가 없어요!');
            }
        }


        function renderErrorMessage(message) {
            const ctx = document.getElementById('myChart').getContext('2d');
            if (myChart) myChart.destroy();
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            ctx.fillStyle = '#666'; ctx.font = '16px Arial'; ctx.textAlign = 'center';
            ctx.fillText(message, ctx.canvas.width / 2, ctx.canvas.height / 2);
        }

        function showInfo() {
            showPage('infoPage');
            const indicator = currentIndicator;
            const info = {
                'WTREGEN': {'title': '미 정부 TGA 잔고', 'content': {'경제적 의미': 'Treasury General Account (TGA)는 미국 정부의 현금 잔고 입니다. 이 잔고의 증가는 정부가 시장 유동성을 흡수했음을 말하며, 감소는 재무부가 시장에 유동성을 정책을 통해 공급했음을 의미할 수 있습니다.', '왜 필요한 지표인가': 'TGA 잔고는 유동성(시장에 순환하는 돈의 양)에 직접적인 영향을 미칩니다. 잔고가 급격히 변동하면 단기 금리나 금융 시장 안정성에 영향을 줄 수 있어 모니터링이 필요합니다.'}},
                'WRESBAL': {'title': '미 은행 지급준비금', 'content': {'경제적 의미': '미 은행이 연방준비제도(FRB)에 예치한 의무적 예금으로, 은행 시스템의 유동성을 조절하는 데 사용됩니다. 이 수치가 높으면 은행이 대출을 줄일 가능성이 있고, 낮으면 대출이 증가할 수 있습니다. 반대로 준비금이 높다는건 은행 시스템에 유동성이 풍부하다는 것을 의미가 될 수 있습니다.', '왜 필요한 지표인가': '지급준비금은 통화 공급량과 신용 창출에 영향을 미치며, 연준의 통화 정책(예: 양적 완화 또는 긴축)의 효과를 평가하는 데 핵심 지표입니다. 경제 과열이나 침체를 방지하기 위해 모니터링됩니다.'}},
                'M2SL': {'title': 'M2', 'content': {'경제적 의미': 'M2는 전통적인 은행 활동에 의한 화폐 공급량을 의미합니다. 예를 들면 은행에서의 현금, 수시입출금 예금, 저축 예금, 그리고 소액의 정기 예금을 포함합니다. 하지만 최근들어 MMF(Money Market Fund)의 자금 조달로 인한 M2에 간접적인 영향을 줄 수는 있겠으나, MMF 자금 유동성이 급격히 변동하더라도, M2 수치에 즉각적으로 반영되진 않을 수 있습니다. Stable Coin에 의한 자금 유동성 또한 M2에 직접 포함되지는 않습니다.', '왜 필요한 지표인가': 'M2는 전통적인 인플레이션, 경제 성장, 소비 동향을 예측하는 데 사용됩니다. 급격한 증가나 감소는 통화 정책 조정(예: 금리 인상/인하)의 신호로 해석될 수 있어 중요합니다.'}},
                'M1SL': {'title': 'M1', 'content': {'경제적 의미': 'M1은 화폐 공급량의 좁은 정의로, 현금과 수시입출금 예금을 포함합니다. 이는 가장 유동성이 높은 자산을 나타냅니다. M2와 마찬가지로 MMF와 Stable Coin에 의한 영향성은 제한적입니다.', '왜 필요한 지표인가': 'M1은 단기적인 지출 능력과 유동성 수준을 반영하며, 경제 활동의 초기 신호를 제공합니다. 특히 통화 정책의 실시간 영향을 분석하는 데 유용합니다.'}},
                'SOFR': {'title': 'SOFR 금리', 'content': {'경제적 의미': 'SOFR은 Secured Overnight Financing Rate의 약자로, 미국에서 한밤사이(overnight) 동안 담보(예: 미국 재무부 증권)를 기반으로 한 대출 거래의 이자율을 평균한 기준 금리입니다. 즉, SOFR은 금융기관(예: 증권사, 헤지펀드 등)이 다른 금융기관으로부터 담보를 제공하고 자금을 빌리는 비용을 나타냅니다.', '왜 필요한 지표인가': 'SOFR은 단기 자금 시장의 유동성과 수요-공급 상황을 반영합니다. 예를 들어, 시장에 자금이 부족하면 SOFR이 상승하고, 자금이 풍부하면 하락합니다. 이는 금융기관이 하루 동안 자금을 조달하거나 투자할 때 참고하는 중요한 기준 금리입니다. 시중에 자금이 넘치는지, 안넘치는지의 지표가 될 수 있습니다.'}},
                'FEDFUNDS': {'title': 'EFFR 금리', 'content': {'경제적 의미': 'EFFR는 Effective Federal Funds Rate의 약자로, 은행들이 연준에 예치된 자금을 다른 은행에 상호 대출할 때 적용되는 실제 금리를 의미합니다. 연준 기준 금리와 밀접하게 연관됩니다.', '왜 필요한 지표인가': 'EFFR은 연준의 통화 정책 방향을 보여주며, 경제 성장, 인플레이션, 고용에 영향을 미칩니다. 예를 들면, EFFR 금리가 높다는건, 은행간의 대출 부담을 높여서 시중에 빌리는 돈의 규모를 축소한다는 의미가 될 수 있습니다. 결과적으로 긴축 효과를 냅니다.'}},
                'IORB': {'title': 'IORB 금리', 'content': {'경제적 의미': 'IORB(Interest on Reserve Balances)는 은행들이 연준에 예치한 초과 지급준비금에 대해 연준이 지급하는 이자율입니다.', '왜 필요한 지표인가': '연준은 이 금리를 조절함으로써 은행들의 초과준비금 보유 여부와 유동성 공급에 영향을 줍니다. IORB는 연준의 정책금리(페드 펀드 금리) 목표 범위 하단에 위치하며, 은행들이 자금을 대출로 제공하거나 지급준비금으로 보유할 때의 유인을 조절하는 중요한 도구입니다.'}},
                'SOFR_FEDFUNDS_SPREAD': {'title': 'SOFR, EFFR 스프레드', 'content': {'경제적 의미': '만약 SOFR이 급등하거나 EFFR과의 스프레드가 확대된다면, 이는 은행이 시중으로부터 달러 수요가 급증했음을 의미합니다. 이 같은 상황은 유동성 긴축이나 시장 불안의 신호를 의미할 수 있습니다. 반대로 스프레드가 축소되면 시장의 유동성이 풍부하거나 무담보 대출 환경이 개선된 신호일 수 있습니다.', '왜 필요한 지표인가': '이 스프레드 지표를 통해, 시장의 유동성 상황을 평가하고 미리 파악하는데 도움을 받을 수 있습니다.'}},
                'SOFR_IORB_SPREAD': {'title': 'SOFR, IORB 스프레드', 'content': {'경제적 의미': 'SOFR이 IORB 이하로 유지되면 시중 유동성이 풍부해지고, 은행 간 자금 조달이 원활하다는 것을 의미합니다. (=유동성 과잉 신호)<br>반대로 SOFR이 IORB보다 높아지면, 은행들이 자금을 연준에 초과준비금으로 예치하는 것보다 시장으로부터 자금을 빌리는 것이 더 비용이 많이 든다는 것을 의미합니다. 이는 은행 간 자금 수요가 많아져 유동성 부족이 발생했음을 시사할 수 있습니다.', '왜 필요한 지표인가': '이 스프레드 지표를 통해, 시장의 유동성 상황을 평가하고 미리 파악하는데 도움을 받을 수 있습니다.'}},
                'TB3MS': {'title': '3개월 미 국채금리', 'content': {'경제적 의미': '3개월 만기 미국 재무부 증권의 수익률로, 단기 시장 금리와 인플레이션 기대치를 반영합니다.', '왜 필요한 지표인가': '단기 금리 동향을 파악하고, 경제 회복 또는 침체 신호를 분석하는 데 유용합니다. 3개월 만기 국채 금리가 상승한다는 의미는, 미국 정부가 국채 발행을 많이해서 원하는 곳에 돈을 많이 풀고 싶다는 간접적인 의미가 될 수 있고, 반대로 미국채 수요가 적어서 금리가 상승할 수 있습니다.'}},
                'TB1YR': {'title': '1년물 미 국채금리', 'content': {'경제적 의미': '1년 만기 미국 재무부 증권의 수익률로, 중단기 금리와 경제 전망을 반영합니다.', '왜 필요한 지표인가': '단기와 장기 금리 간 관계를 통해 경제 성장 기대치나 인플레이션 우려를 파악할 수 있어, 투자자와 정책 입안자에게 중요합니다. 또한 금리가 상승한다는 의미는, 미국 정부가 국채 발행을 많이해서 원하는 곳에 돈을 많이 풀고 싶다는 간접적인 의미가 될 수 있고, 반대로 미국채 수요가 적어서 금리가 상승할 수 있습니다.'}},
                'DGS10': {'title': '10년물 미 국채금리', 'content': {'경제적 의미': '10년물 미국채 금리는 10년 만기 미국 재무부 증권의 수익률을 의미합니다. 이는 중장기 금리를 대표하며, 시장의 경제 성장 기대치와 인플레이션 전망을 반영하는 핵심 지표입니다. 투자자들이 미래에 대한 긍정적인 전망을 하면 금리가 오르고, 비관적인 전망을 하면 금리가 떨어지는 경향이 있습니다.', '왜 필요한 지표인가': '10년물 미국채 금리는 경제의 현재 상황과 미래 전망을 보여주는 바로미터 역할을 하며, 정부의 재정 정책과 시장의 투자 심리가 복합적으로 반영된 지표입니다.'}},
                'RRPONTSYD': {'title': '연준 역레포 자금', 'content': {'경제적 의미': 'Reverse Repurchase Agreement(RRP)는 연준이 금융기관으로부터 자산을 매입하며 시중의 유동성을 흡수하는 도구입니다. 이 금액은 시장의 묶여있는 돈. 즉, 잉여 자금을 보여줍니다.', '왜 필요한 지표인가': '연준이 금리를 통제하거나 유동성을 조절할 때 사용되며, 시장의 과도한 유동성(예: 인플레이션 위험)을 관리하는 데 필요합니다. 즉, 연레포 자금이 증가한다는 것은, 시중에 풀린 돈을 중앙은행에 묶어둔다는 뜻 입니다. 이렇게 되면 유동성이 긴축되어 시장의 주가가 감소할 수 있습니다.'}},
                'MMMFFAQ027S': {'title': 'MMF 잔고', 'content': {'경제적 의미': 'Money Market Fund(MMF)의 총 자산 잔고로, 투자자들이 안전 자산에 얼마나 많은 자금을 넣는지 보여줍니다. 주로 기준금리가 높은 시기에 수익율이 높아서 몰리거나, 시장(주식) 가격이 불안정할 수 있다고 예상되면 MMF로 자금이 몰리게 됩니다.', '왜 필요한 지표인가': 'MMF 잔고는 투자 심리와 위험 회피 성향을 반영하며, 금융 시장 불확실성이 높을 때 증가하는 경향이 있어 경제 안정성 평가에 유용합니다.'}},
                'SP500': {'title': 'S&P500 지수', 'content': {'경제적 의미': '미국 500대 기업의 주식 성과를 종합한 지수로, 주식 시장의 전반적인 건강 상태를 나타냅니다.', '왜 필요한 지표인가': '경제 성장, 기업 수익, 투자자 신뢰를 반영하며, 소비자 지출과 연결되므로 거시경제 분석에 필수적입니다.'}},
                'DPCREDIT': {'title': '연준 할인율', 'content': {'경제적 의미': '연준이 상업 은행에 대출할 때 적용하는 이자율로, 금융기관의 자금 조달 비용을 결정합니다. 할인율이 낮게 되면, 연준이 시중 은행에 돈을 풀고 싶다는 의미가 될 수 있습니다.', '왜 필요한 지표인가': '은행의 유동성 지원과 신용 경색 방지에 사용되며, 연준의 긴급 통화 정책을 평가하는 데 중요합니다.'}},
                'DRBLACBS': {'title': '미 은행 연체율(전체)', 'content': {'경제적 의미': '은행 대출 중 연체된 비율로, 대출자의 상환 능력과 신용 위험을 나타냅니다.', '왜 필요한 지표인가': '경제 침체 신호나 금융 시스템의 건전성을 평가하며, 대출 정책과 규제 강화의 기초 자료로 사용됩니다.'}},
                'NASDAQ100': {'title': '나스닥100 지수', 'content': {'경제적 의미': '기술주 중심의 100개 기업 주가를 반영한 지수로, 기술 섹터의 성과를 보여줍니다.', '왜 필요한 지표인가': '기술 산업의 성장과 혁신을 반영하며, 글로벌 경제에서 기술 의존도가 높아짐에 따라 중요한 기준이 됩니다.'}},
                'WALCL': {'title': '연준 전체 자산 + 부채', 'content': {'경제적 의미': '연준의 총 자산(예: 채권 보유량 등)과 부채(예: 역레포 및 준비금 등)를 합친 금액으로, 연준의 재무 상태를 나타냅니다.', '왜 필요한 지표인가': '양적 완화나 긴축 정책의 규모를 보여주며, 연준의 통화 정책과 시장 유동성에 미치는 영향을 분석하는 데 필수적입니다.'}},
                'SP500_MCAP': {'title': 'S&P500 시가총액', 'content': {'경제적 의미': 'S&P500 지수에 포함된 기업들의 총 시가총액입니다. 이는 미국 주식 시장의 전반적인 규모와 가치를 나타내며, 경제의 전반적인 건전성과 투자 심리를 반영합니다.', '왜 필요한 지표인가': '주식 시장의 과열 또는 침체 여부를 판단하는 데 중요한 지표입니다. 시가총액의 증가는 경제 성장과 기업 수익성 개선을, 감소는 경기 둔화나 불확실성 증대를 시사할 수 있습니다.'}},
                'RRPONTSYAWARD': {'title': '역레포 금리', 'content': {'경제적 의미': '연준이 금융기관으로부터 자금을 빌릴 때 지급하는 금리로, 시중에 넘치는 유동성을 흡수하기 위한 기준 금리입니다. 즉, 금리가 높아질수록 시중의 유동성을 흡수하는 역할을 합니다.', '왜 필요한 지표인가': '시장의 유동성이 지나치게 풍부할 때 연준의 의도로 금리가 떨어지는 것을 막는 역할을 합니다. 왜냐하면 역레포 금리는 금융기관이 연준에 돈을 맡길 때 보장받는 최저 수익률 역할을 합니다. 따라서 금융기관들은 역레포 금리보다 낮은 금리로 다른 곳에 돈을 빌려주지 않으려 하기 때문에, 단기 금리가 연준의 목표 수준 이하로 떨어지는 것을 막는 역할을 합니다.'}},
                'ALTSALES': {'title': '자동차, 트럭 판매량', 'content': {'경제적 의미': '자동차 및 모든 승용차 판매량에 대한 미 상무부 경제분석국의 보고입니다. 이 지수가 높다면, 강한 경제를 나타냅니다.', '왜 필요한 지표인가': '미국 시장의 주요한 경제 **선행지표** 중 하나입니다.'}},
                'HOUST': {'title': '주택 착공 허가 건수', 'content': {'경제적 의미': '주택 착공은 특정 달에 시작된 새로운 주거 건설 프로젝트의 수를 의미합니다. 주택 착공 추정치에는 기존 기반 위에 완전히 재건되는 건물의 단위도 포함됩니다. 이 지수가 높다면, 강한 경제를 나타냅니다.', '왜 필요한 지표인가': '미국 시장의 주요한 경제 **선행지표** 중 하나입니다.'}},
                'DCOILBRENTEU': {'title': '국제 유가', 'content': {'경제적 의미': '유럽과 전 세계 유가의 기준이 되는 지표를 의미합니다.', '왜 필요한 지표인가': '역사적으로 유가가 감소하면, 경제 부흥이 일어나고, 유가가 상승하면 경기 침체 및 하락 국면을 보이기도 합니다. 따라서 중요하게 모니터링할 지표입니다.'}}
            }[indicator] || { title: indicator, content: { '경제적 의미': '정보 없음' } };
            document.getElementById('infoTitle').textContent = info.title || 'Unknown';
            document.getElementById('infoContent').innerHTML = Object.entries(info.content)
                .map(([key, value]) => `<p><strong>${key}:</strong> ${value}</p>`).join('');
        }
        
        const getClosestData = (data, targetDate) => {
            if (!data || data.length === 0) return null;
            let closest = data[data.length - 1];
            let minDiff = Math.abs(new Date(closest.date) - targetDate);
            for (let i = data.length - 2; i >= 0; i--) {
                const currentData = data[i];
                const diff = Math.abs(new Date(currentData.date) - targetDate);
                if (diff < minDiff) {
                    minDiff = diff;
                    closest = currentData;
                } else { break; }
            }
            return closest;
        };

        async function updateLiquidityFlowAnimation() {
            stopLiquidityFlowAnimation();
            const displays = {
                tga: document.getElementById('tgaSlopeDisplay'), fed: document.getElementById('fedLiquidityDisplay'),
                mmf_fed: document.getElementById('mmfToRrpDisplay'), mmf_market: document.getElementById('mmfToMarketDisplay'),
                net_market_flow: document.getElementById('netMarketFlowDisplay')
            };
            Object.values(displays).forEach(el => {
                if (el) { el.innerHTML = el.id !== 'netMarketFlowDisplay' ? "계산 중..." : ""; el.style.color = "black"; }
            });
            const tooltips = {
                tga: document.getElementById('tga-tooltip-content'), fed: document.getElementById('fed-tooltip-content'),
                mmf_fed: document.getElementById('mmf-fed-tooltip-content'), mmf_market: document.getElementById('mmf-market-tooltip-content')
            };
            const indicators = ['WTREGEN', 'WALCL', 'RRPONTSYD', 'WRESBAL', 'MMMFFAQ027S', 'MMF2RRP', 'MMF2MARKET', 'MMF2GOVERNMENT'];
            const dataStore = {};
            try {
                const results = await Promise.all(indicators.map(indicator => fetchAndCacheData(indicator).catch(e => {
                    console.error(`Error fetching ${indicator}:`, e); return [];
                })));
                indicators.forEach((indicator, index) => { dataStore[indicator] = results[index]; });
            } catch (error) {
                console.error("Failed to load initial data for liquidity flow", error);
                Object.values(displays).forEach(el => { if (el) el.textContent = "데이터 오류"; }); return;
            }
            let tgaDiff = null, fedLiquidityDiff = null, mmfToFedDiff = null, finalMmfToMarketDiff = null;
            let tgaLatestDate = null, fedLatestDate = null, mmfFedLatestDate = null, mmfMarketLatestDate = null;
            let mmfToMarketCombined = null, mmfAssetChange = null;
            const thirtyDaysAgo = (date) => { const newDate = new Date(date); newDate.setDate(newDate.getDate() - 30); return newDate; };

            if (['WTREGEN', 'WALCL', 'RRPONTSYD', 'WRESBAL'].every(i => dataStore[i] && dataStore[i].length > 0)) {
                const lastDates = ['WTREGEN', 'WALCL', 'RRPONTSYD', 'WRESBAL'].map(i => new Date(dataStore[i][dataStore[i].length - 1].date));
                const commonLatest = new Date(Math.min(...lastDates));
                tgaLatestDate = fedLatestDate = commonLatest.toISOString().split('T')[0];
                const pastDate = thirtyDaysAgo(commonLatest);
                const latest = {
                    tga: getClosestData(dataStore.WTREGEN, commonLatest)?.value, walcl: getClosestData(dataStore.WALCL, commonLatest)?.value,
                    rrp: getClosestData(dataStore.RRPONTSYD, commonLatest)?.value, resbal: getClosestData(dataStore.WRESBAL, commonLatest)?.value
                };
                const past = {
                    tga: getClosestData(dataStore.WTREGEN, pastDate)?.value, walcl: getClosestData(dataStore.WALCL, pastDate)?.value,
                    rrp: getClosestData(dataStore.RRPONTSYD, pastDate)?.value, resbal: getClosestData(dataStore.WRESBAL, pastDate)?.value
                };
                if (Object.values(latest).every(v => v != null) && Object.values(past).every(v => v != null)) {
                    tgaDiff = latest.tga - past.tga;
                    const walclDiff = (latest.walcl / 1000) - (past.walcl / 1000);
                    const rrpDiff = latest.rrp - past.rrp;
                    const resbalDiff = latest.resbal - past.resbal;
                    
                    // MAINTAINED: Kept the original calculation logic as requested by the user.
                    fedLiquidityDiff = walclDiff - (tgaDiff + 2 * rrpDiff + 2 * resbalDiff);
                    
                    const fedAssetChange = walclDiff - tgaDiff - rrpDiff - resbalDiff;
                    const fedLiabilityChange = rrpDiff + resbalDiff;
                    const formatValue = (value) => `<span class="${value > 0 ? 'slope-positive' : 'slope-negative'}">${value > 0 ? '+' : ''}${value.toFixed(2)} B $/Month</span>`;
                    tooltips.fed.innerHTML = `
                        <p>최근 한 달 동안, 연준의 순자산(국채+모기지채 등)과 부채의 변화를 나타냅니다.</p>
                        <p><b>+양수 :</b> 시장의 채권 등 자산 구매를 통해 달러를 시장에 공급 (or) 역레포 자금을 시장에 품<br><b>-음수 :</b> 자산 매각을 통해 시중의 달러를 다시 회수 (or) 시장으로부터 역레포 자금을 충당(긴축)</p><hr>
                        <p>연준 자산 변화량 = ${formatValue(fedAssetChange)}</p><p>연준의 부채 (역레포와 지급준비금) 변화량 = ${formatValue(fedLiabilityChange)}</p>
                        <button class="graph-btn" onclick="showGraph('WALCL')">그래프</button><span class="update-date">Update Date: ${fedLatestDate}</span>`;
                }
            }
            if (dataStore.MMF2RRP?.length > 0) {
                const latestDate = new Date(dataStore.MMF2RRP[dataStore.MMF2RRP.length - 1].date);
                mmfFedLatestDate = latestDate.toISOString().split('T')[0];
                const pastDate = thirtyDaysAgo(latestDate);
                const latestVal = getClosestData(dataStore.MMF2RRP, latestDate)?.value;
                const pastVal = getClosestData(dataStore.MMF2RRP, pastDate)?.value;
                if (latestVal != null && pastVal != null) { mmfToFedDiff = (latestVal - pastVal) / 1e9; }
            }
            if (dataStore.MMF2MARKET?.length > 0 && dataStore.MMF2GOVERNMENT?.length > 0) {
                 const latestDateM = new Date(dataStore.MMF2MARKET[dataStore.MMF2MARKET.length - 1].date); const pastDateM = thirtyDaysAgo(latestDateM);
                 const latestM = getClosestData(dataStore.MMF2MARKET, latestDateM)?.value; const pastM = getClosestData(dataStore.MMF2MARKET, pastDateM)?.value;
                 const latestDateG = new Date(dataStore.MMF2GOVERNMENT[dataStore.MMF2GOVERNMENT.length - 1].date); const pastDateG = thirtyDaysAgo(latestDateG);
                 const latestG = getClosestData(dataStore.MMF2GOVERNMENT, latestDateG)?.value; const pastG = getClosestData(dataStore.MMF2GOVERNMENT, pastDateG)?.value;
                 mmfMarketLatestDate = latestDateM.toISOString().split('T')[0];
                 if(latestM != null && pastM != null && latestG != null && pastG != null) { mmfToMarketCombined = ((latestM - pastM) + (latestG - pastG)) / 1e9; }
            }
            if (dataStore.MMMFFAQ027S?.length > 0) {
                const latestDate = new Date(dataStore.MMMFFAQ027S[dataStore.MMMFFAQ027S.length-1].date);
                const pastDate = thirtyDaysAgo(latestDate);
                const latestVal = getClosestData(dataStore.MMMFFAQ027S, latestDate)?.value; const pastVal = getClosestData(dataStore.MMMFFAQ027S, pastDate)?.value;
                if(latestVal != null && pastVal != null){ mmfAssetChange = (latestVal - pastVal) / 1e9; }
            }
            if (mmfToMarketCombined != null && mmfAssetChange != null) { finalMmfToMarketDiff = mmfToMarketCombined - mmfAssetChange; }
            
            if (tgaDiff != null) { const sign = tgaDiff > 0 ? '+' : ''; displays.tga.innerHTML = `TGA 잔고:<br><span class="${tgaDiff > 0 ? 'slope-positive' : 'slope-negative'}">${sign}${tgaDiff.toFixed(2)} B $/Month</span>`;
                tooltips.tga.innerHTML = `<p>최근 한 달 동안, 미국 재무부 잔고 변화를 나타냅니다.</p><p><b>+양수 :</b> 시장에서 재무부로 달러 유동성 흡수<br><b>-음수 :</b> 미국 재무부가 시장에 달러 유동성 공급</p>
                <button class="graph-btn" onclick="showGraph('WTREGEN')">그래프</button><span class="update-date">Update Date: ${tgaLatestDate}</span>`;
            } else { displays.tga.textContent = "TGA 데이터 오류"; }
            if (fedLiquidityDiff != null) { const sign = fedLiquidityDiff > 0 ? '+' : ''; displays.fed.innerHTML = `연준 유동성:<br><span class="${fedLiquidityDiff > 0 ? 'slope-positive' : 'slope-negative'}">${sign}${fedLiquidityDiff.toFixed(2)} B $/Month</span>`;
            } else { displays.fed.textContent = "연준 데이터 오류"; }
            if (mmfToFedDiff != null) { const sign = mmfToFedDiff > 0 ? '+' : ''; displays.mmf_fed.innerHTML = `MMF -> FED:<br><span class="${mmfToFedDiff > 0 ? 'slope-positive' : 'slope-negative'}">${sign}${mmfToFedDiff.toFixed(2)} B $/Month</span>`;
                tooltips.mmf_fed.innerHTML = `<p>최근 한 달 동안, MMF가 연준에게 돈을 맡긴 자금의 양 변화를 나타냅니다.</p><p><b>+양수 :</b> MMF가 연준에게 역레포 자금을 빌려줌<br><b>-음수 :</b> 연준에게 빌려준 역레포 자금을 다시 회수</p>
                <button class="graph-btn" onclick="showGraph('RRPONTSYD')">그래프</button><span class="update-date">Update Date: ${mmfFedLatestDate}</span>`;
            } else { displays.mmf_fed.textContent = "MMF->FED 데이터 오류"; }
            if (finalMmfToMarketDiff != null) { const sign = finalMmfToMarketDiff > 0 ? '+' : ''; displays.mmf_market.innerHTML = `MMF ->시장:<br><span class="${finalMmfToMarketDiff > 0 ? 'slope-positive' : 'slope-negative'}">${sign}${finalMmfToMarketDiff.toFixed(2)} B $/Month</span>`;
                const sign1 = mmfToMarketCombined > 0 ? '+' : ''; const sign2 = mmfAssetChange > 0 ? '+' : '';
                tooltips.mmf_market.innerHTML = `<p>최근 한 달 동안, MMF가 시장에 돈을 공급한 자금의 양 변화를 나타냅니다.<br>이 결과는 MMF가 시장에 공급한 유동성에서 시장이 MMF에 투자한 양을 뺀 결과입니다.</p>
                <p><b>+양수 :</b> MMF가 시장에 유동성 공급량이 큰 상황<br><b>-음수 :</b> 시장이 MMF에 자금을 투자한 양이 큰 상황</p><hr>
                <p>MMF가 시장으로 유동성 공급량 = <span class="${mmfToMarketCombined > 0 ? 'slope-positive' : 'slope-negative'}">${sign1}${mmfToMarketCombined.toFixed(2)} B $/Month</span></p>
                <p>시장이 MMF에 투자량 = <span class="${mmfAssetChange > 0 ? 'slope-positive' : 'slope-negative'}">${sign2}${mmfAssetChange.toFixed(2)} B $/Month</span></p>
                <button class="graph-btn" onclick="showGraph('MMMFFAQ027S')">그래프</button><span class="update-date">Update Date: ${mmfMarketLatestDate}</span>`;
            } else { displays.mmf_market.textContent = "MMF->시장 데이터 오류"; }
            if (fedLiquidityDiff != null && tgaDiff != null && finalMmfToMarketDiff != null) {
                const netMarketFlow = fedLiquidityDiff - tgaDiff + finalMmfToMarketDiff;
                const sign = netMarketFlow > 0 ? '+' : '';
                displays.net_market_flow.innerHTML = `<b>시장 Total 유동 공급량<br> = <span class="${netMarketFlow > 0 ? 'slope-positive' : 'slope-negative'}">${sign}${netMarketFlow.toFixed(2)} B $/Month</span></b>`;
            } else { displays.net_market_flow.textContent = ''; }
            
            const calculatedValues = [];
            if (tgaDiff != null) calculatedValues.push({ value: tgaDiff, animationClass: tgaDiff < 0 ? 'animated-dollar-from-government' : 'animated-dollar-to-government' });
            if (fedLiquidityDiff != null) calculatedValues.push({ value: fedLiquidityDiff, animationClass: fedLiquidityDiff < 0 ? 'animated-dollar-to-fed' : 'animated-dollar-to-market' });
            if (mmfToFedDiff != null) calculatedValues.push({ value: mmfToFedDiff, animationClass: mmfToFedDiff >= 0 ? 'animated-dollar-from-mmf-to-fed' : 'animated-dollar-from-fed-to-mmf' });
            if (finalMmfToMarketDiff != null) calculatedValues.push({ value: finalMmfToMarketDiff, animationClass: finalMmfToMarketDiff > 0 ? 'animated-dollar-from-mmf-to-market_parabolic' : 'animated-dollar-from-market-to-mmf_parabolic' });
            const rankedAnimations = calculatedValues.sort((a, b) => Math.abs(b.value) - Math.abs(a.value));
            const startAnimations = () => {
                rankedAnimations.forEach((task, index) => {
                    const factor = (4 - index) / 4.0; if (factor <= 0) return;
                    const size = BASE_DOLLAR_SIZE * factor; const duration = BASE_ANIMATION_DURATION / factor;
                    const spawnInterval = duration / NUM_DOLLAR_ANIMATIONS;
                    for (let i = 0; i < NUM_DOLLAR_ANIMATIONS; i++) {
                        const timeoutId = setTimeout(() => createAndAnimateDollar(task.animationClass, size, duration), i * spawnInterval);
                        dollarAnimationIntervals.push(timeoutId);
                    }
                });
            };
            if (rankedAnimations.length > 0) { startAnimations(); const resetIntervalId = setInterval(startAnimations, BASE_ANIMATION_DURATION); dollarAnimationIntervals.push(resetIntervalId); }
        }
        
        async function updateInterestRateFlowData() {
            const indicatorConfigs = {
                sofr: { code: 'SOFR', label: 'SOFR 금리 :', tooltip: `<p>SOFR 금리는 미국에서 한밤사이 동안 금융기관이 다른 금융기관에 담보(예: 국채)를 제공하고 자금을 빌리는 비용을 나타냅니다.</p><p><b>왜 중요한가? :</b> SOFR은 단기 자금 시장의 유동성과 수요-공급 상황을 반영합니다. 예를 들어, 시장에 자금이 부족하면 SOFR이 상승하고, 자금이 풍부하면 하락합니다.</p>`, displayEl: document.getElementById('sofrRateDisplay_interest'), tooltipEl: document.getElementById('sofr-rate-tooltip-content_interest') },
                effr: { code: 'FEDFUNDS', label: 'EFFR 금리 :', tooltip: `<p>EFFR 금리는 은행들이 연준에 예치된 자금을 시중은행 간 상호 대출할 때 적용되는 실제 금리를 의미합니다.</p><p><b>왜 중요한가? :</b> EFFR 금리가 높다는건, 은행간의 대출 부담을 높여서 시중에 빌리는 돈의 규모를 축소한다는 의미가 될 수 있습니다.</p>`, displayEl: document.getElementById('effrRateDisplay_interest'), tooltipEl: document.getElementById('effr-rate-tooltip-content_interest') },
                rrp_rate: { code: 'RRPONTSYAWARD', label: '역레포 금리 :', tooltip: `<p>연준이 금융기관으로부터 자금을 빌릴 때 지급하는 금리로, 시중에 넘치는 유동성을 흡수하기 위한 기준 금리입니다.</p><p><b>왜 중요한가? :</b> 역레포 금리가 높아질수록 시중의 유동성을 흡수하는 역할을 합니다.</p>`, displayEl: document.getElementById('rrpRateDisplay_interest'), tooltipEl: document.getElementById('rrp-rate-tooltip-content_interest') },
                tb3ms: { code: 'TB3MS', label: '3개월 미 국채금리 :', tooltip: `<p>3개월 만기 미국 재무부 증권의 수익률로, 단기 시장 금리와 인플레이션 기대치를 반영합니다.</p><p><b>왜 중요한가? :</b> 3개월 금리가 상승한다는 의미는, 미국 정부가 국채 발행을 많이해서 원하는 곳에 돈을 많이 풀고 싶다는 간접적인 의미가 될 수 있고, 반대로 미국채 수요가 적어서 금리가 상승할 수 있습니다.</p>`, displayEl: document.getElementById('tb3msRateDisplay_interest'), tooltipEl: document.getElementById('tb3ms-tooltip-content_interest') },
                tb1yr: { code: 'TB1YR', label: '1년물 미 국채금리 :', tooltip: `<p>1년 만기 미국 재무부 증권의 수익률로, 중단기 금리와 경제 전망을 반영합니다.</p><p><b>왜 중요한가? :</b> 1년 만기 금리가 상승한다는 의미는, 미국 정부가 국채 발행을 많이해서 원하는 곳에 돈을 많이 풀고 싶다는 간접적인 의미가 될 수 있고, 반대로 미국채 수요가 적어서 금리가 상승할 수 있습니다.</p>`, displayEl: document.getElementById('tb1yrRateDisplay_interest'), tooltipEl: document.getElementById('tb1yr-tooltip-content_interest') },
                tb10yr: { code: 'DGS10', label: '10년물 미 국채금리 :', tooltip: `<p>10년 만기 미국 재무부 증권의 수익률로, 시장의 경제 성장 기대치와 인플레이션 전망을 반영하는 핵심 지표입니다.</p><p><b>왜 중요한가? :</b> 10년물 미국채 금리는 경제의 현재 상황과 미래 전망을 보여주는 바로미터 역할을 하며, 정부의 재정 정책과 시장의 투자 심리가 복합적으로 반영된 지표입니다.</p>`, displayEl: document.getElementById('tb10yrRateDisplay_interest'), tooltipEl: document.getElementById('tb10yr-tooltip-content_interest') },
                discount: { code: 'DPCREDIT', label: '연준 할인율 :', tooltip: `<p>연준 할인율은 연준이 상업 은행에 대출할 때 적용하는 이자율로, 금융기관의 자금 조달 비용을 결정합니다. </p><p><b>왜 중요한가? :</b> 할인율이 낮게 되면, 연준이 시중 은행에 돈을 풀고 싶다는 의미가 될 수 있습니다.</p>`, displayEl: document.getElementById('discountRateDisplay_interest'), tooltipEl: document.getElementById('discount-rate-tooltip-content_interest') }
            };
            Object.values(indicatorConfigs).forEach(({ displayEl }) => { if(displayEl) displayEl.textContent = "계산 중..."; });
            if(document.getElementById('netMarketFlowDisplay_interest')) { document.getElementById('netMarketFlowDisplay_interest').textContent = ''; }
            const updateIndicator = async (key) => {
                const config = indicatorConfigs[key];
                try {
                    const data = await fetchAndCacheData(config.code);
                    if (data && data.length > 0) {
                        const { value, date } = data[data.length - 1];
                        config.displayEl.innerHTML = `${config.label}<br><span style="color: black;">${value.toFixed(2)} %</span>`;
                        config.tooltipEl.innerHTML = `${config.tooltip}<button class="graph-btn" onclick="showGraph('${config.code}')">그래프</button><span class="update-date">Update Date: ${date}</span>`;
                    } else { throw new Error("No data available"); }
                } catch (error) { console.error(`${config.code} 데이터 로드 실패:`, error.message); config.displayEl.textContent = '데이터 오류'; }
            };
            await Promise.all(Object.keys(indicatorConfigs).map(key => updateIndicator(key)));
        }

        function createAndAnimateDollar(animationClass, size, duration) {
            const dollar = document.createElement('img');
            dollar.src = "./icon/dollar.jpg"; dollar.alt = "Dollar"; dollar.className = 'dollar-animated-object';
            dollar.style.width = `${size}px`; dollar.style.height = `${size}px`;
            dollar.style.setProperty('--animation-duration', `${duration / 1000}s`);
            dollar.classList.add(animationClass);
            document.getElementById('liquidityFlow').appendChild(dollar);
            dollar.addEventListener('animationend', () => dollar.remove());
        }

        function stopLiquidityFlowAnimation() {
            dollarAnimationIntervals.forEach(id => { clearTimeout(id); clearInterval(id); });
            dollarAnimationIntervals = [];
            document.querySelectorAll('.dollar-animated-object').forEach(el => el.remove());
        }

        function startDragging(e) { if(myChart) { isDragging = true; startX = e.pageX - e.target.getBoundingClientRect().left; startScrollX = myChart.options.scales.x.min; e.target.style.cursor = 'grabbing'; }}
        function drag(e) {
            if (!isDragging || !myChart) return;
            e.preventDefault();
            const { x } = myChart.scales; const dataRange = x.max - x.min; const pixelRange = myChart.chartArea.right - myChart.chartArea.left;
            if (pixelRange <= 0) return;
            const dataOffset = ((e.pageX - e.target.getBoundingClientRect().left - startX) * 0.6 / pixelRange) * dataRange;
            let newMin = startScrollX - dataOffset; let newMax = newMin + dataRange;
            
            const allDates = currentGraphData.flatMap(ds => ds.data.map(d => new Date(d.x).getTime()));
            const minAllowed = Math.min(...allDates); 
            const maxAllowed = Math.max(...allDates);

            if (newMin < minAllowed) { newMin = minAllowed; newMax = newMin + dataRange; }
            if (newMax > maxAllowed) { newMax = maxAllowed; newMin = newMax - dataRange; }
            myChart.options.scales.x.min = newMin; myChart.options.scales.x.max = newMax; myChart.update('none');
        }
        function stopDragging(e) { if(isDragging) { isDragging = false; e.target.style.cursor = 'grab'; }}
        function zoomChart(e) {
            if (!myChart) return;
            e.preventDefault();
            const { x } = myChart.scales; const { min, max } = x; const range = max - min;
            const zoomFactor = e.deltaY < 0 ? 0.9 : 1.1; const mouseX = e.offsetX; const center = x.getValueForPixel(mouseX);
            const newMin = center - (center - min) * zoomFactor; const newMax = center + (max - center) * zoomFactor;
            
            const allDates = currentGraphData.flatMap(ds => ds.data.map(d => new Date(d.x).getTime()));
            const minAllowed = Math.min(...allDates); 
            const maxAllowed = Math.max(...allDates);
            
            if (newMin >= minAllowed && newMax <= maxAllowed) { myChart.options.scales.x.min = newMin; myChart.options.scales.x.max = newMax; myChart.update('none'); }
        }
        function goBackToGraph() { if (currentIndicator) { showPage('graphPage'); } }

    </script>
</body>
</html>