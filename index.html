<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Arial', sans-serif; margin: 0; padding: 0; background: #f4f4f4; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; position: relative; min-height: 100vh; }
        .header { text-align: center; padding: 10px; background: #007bff; color: white; }
        .back-btn { position: absolute; top: 10px; left: 10px; background: none; border: none; cursor: pointer; font-size: 24px; font-weight: bold; color: black; width: 30px; text-align: center; }
        .back-btn::before { content: "◄"; font-size: 36px; }
        .info-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; cursor: pointer; font-size: 20px; }
        .button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .button:hover { background: #0056b3; }

        #liquidityFlow {
            text-align: center;
            padding: 20px;
            position: relative;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        #liquidityFlow .icon-container {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
        }
        #liquidityFlow .icon {
            width: 80px;
            height: 80px;
            display: block;
            object-fit: contain;
        }
        #liquidityFlow .icon-label {
            font-weight: bold;
            color: black;
            font-size: 14px;
            white-space: nowrap;
            margin-top: 5px;
        }

        .FED-container .icon-label {
            order: -1;
            margin-bottom: 5px;
            margin-top: 0;
        }

        .FED-container { top: 20%; left: 50%; }
        .Government-container { top: 50%; left: 20%; }
        .Market-container { top: 80%; left: 50%; }
        .MMF-container { top: 50%; left: 80%; }

        #tgaSlopeDisplay, #fedLiquidityDisplay, #mmfToRrpDisplay, #mmfToMarketDisplay, #mmfToGovernmentDisplay {
            position: absolute;
            transform: translateX(-50%);
            font-size: 0.8em;
            font-weight: bold;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            padding: 3px 6px;
            border-radius: 5px;
            border: 1px solid #ccc;
            text-align: center;
        }

        #tgaSlopeDisplay {
            top: calc(50% + 80px + 14px + 10px);
            left: 20%;
        }
        #fedLiquidityDisplay {
            top: calc(50% + 80px + 14px + 30px);
            left: 20%;
        }
        
        #mmfToRrpDisplay {
            top: calc(50% - 80px - 10px);
            left: 80%;
        }

        #mmfToMarketDisplay {
            top: calc(50% + 80px + 14px + 10px);
            left: 80%;
        }

        #mmfToGovernmentDisplay {
            top: calc(50% - 80px - 10px);
            left: 50%;
        }

        .slope-positive { color: blue; }
        .slope-negative { color: red; }

        .dollar-animated-object {
            position: absolute;
            width: 37.5px;
            height: 37.5px;
            object-fit: contain;
            opacity: 0;
            z-index: 5;
        }

        /* 기존 애니메이션 */
        @keyframes dollarFlowToMarket {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 20%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 20%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
        }

        @keyframes dollarFlowToFED {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 20%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 20%; }
        }

        @keyframes dollarFlowToGovernment {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 20%; top: 50%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 20%; top: 50%; }
        }

        @keyframes dollarFlowFromGovernment {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 20%; top: 50%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 20%; top: 50%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
        }

        /* 신규 MMF 애니메이션 */
        @keyframes dollarFlowFromMmfToFed {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 50%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 50%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 20%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 20%; }
        }
        @keyframes dollarFlowFromFedToMmf {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 20%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 20%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 50%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 50%; }
        }
        @keyframes dollarFlowFromMmfToMarket {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 50%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 50%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
        }
        @keyframes dollarFlowFromMarketToMmf {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 50%; top: 80%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 50%; top: 80%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 50%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 50%; }
        }
        /* MMF to Government 애니메이션 */
        @keyframes dollarFlowFromMmfToGovernment {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 50%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 50%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 20%; top: 50%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 20%; top: 50%; }
        }
        @keyframes dollarFlowFromGovernmentToMmf {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 20%; top: 50%; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 20%; top: 50%; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; left: 80%; top: 50%; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; left: 80%; top: 50%; }
        }

        .animated-dollar-to-market { animation: dollarFlowToMarket var(--animation-duration) linear forwards; }
        .animated-dollar-to-fed { animation: dollarFlowToFED var(--animation-duration) linear forwards; }
        .animated-dollar-to-government { animation: dollarFlowToGovernment var(--animation-duration) linear forwards; }
        .animated-dollar-from-government { animation: dollarFlowFromGovernment var(--animation-duration) linear forwards; }
        
        .animated-dollar-from-mmf-to-fed { animation: dollarFlowFromMmfToFed var(--animation-duration) linear forwards; }
        .animated-dollar-from-fed-to-mmf { animation: dollarFlowFromFedToMmf var(--animation-duration) linear forwards; }
        .animated-dollar-from-mmf-to-market { animation: dollarFlowFromMmfToMarket var(--animation-duration) linear forwards; }
        .animated-dollar-from-market-to-mmf { animation: dollarFlowFromMarketToMmf var(--animation-duration) linear forwards; }
        .animated-dollar-from-mmf-to-government { animation: dollarFlowFromMmfToGovernment var(--animation-duration) linear forwards; }
        .animated-dollar-from-government-to-mmf { animation: dollarFlowFromGovernmentToMmf var(--animation-duration) linear forwards; }

        #graphIndicators { padding: 20px; text-align: center; }
        .indicator-section { margin-bottom: 20px; }
        .indicator-section h3 { font-size: 18px; margin-bottom: 10px; color: #007bff; }
        .indicator-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        #graphPage {
            text-align: center;
            padding: 20px;
            height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        #graphPage canvas {
            max-width: 100%;
            width: 100%;
            height: 400px;
            cursor: grab;
            flex-grow: 1;
        }

        #infoPage { padding: 20px; text-align: center; }
        .time-buttons { margin: 10px 0; display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; }
        .time-btn { padding: 5px 10px; background: #e9ecef; border: 1px solid #ced4da; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: background-color 0.2s; }
        .time-btn:hover { background-color: #dee2e6; }
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #007bff; padding: 10px; display: flex; justify-content: space-around; }
        @media (max-width: 600px) {
            .container { padding: 10px; }
            .back-btn { top: 5px; left: 5px; }
            .info-btn { top: 5px; right: 5px; }
            #liquidityFlow .icon { width: 60px; height: 60px; }
            #liquidityFlow .icon-label { font-size: 12px; }
            .FED-container { top: 15%; left: 50%; }
            .Government-container { top: 40%; left: 15%; }
            .Market-container { top: 85%; left: 50%; }
            .MMF-container { top: 40%; left: 85%; }
            #tgaSlopeDisplay, #fedLiquidityDisplay, #mmfToRrpDisplay, #mmfToMarketDisplay, #mmfToGovernmentDisplay { font-size: 0.7em; padding: 2px 4px; white-space: normal; }
            #tgaSlopeDisplay { top: calc(40% + 60px + 12px + 15px); left: 15%; }
            #fedLiquidityDisplay { top: calc(40% + 60px + 12px + 35px); left: 15%; }
            #mmfToRrpDisplay { top: calc(40% - 60px - 10px); left: 85%; }
            #mmfToMarketDisplay { top: calc(40% + 60px + 12px + 15px); left: 85%; }
            #mmfToGovernmentDisplay { top: calc(40% - 60px - 10px); left: 50%; }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>

    <div class="container">
        <div id="mainPage">
            <header class="header">
                <h1>미국 금융시장 유동성 현황</h1>
            </header>
            <div id="liquidityFlow">
                <div class="icon-container FED-container">
                    <img src="https://raw.githubusercontent.com/yoon-seok/images/main/fed.png" class="icon" alt="FED">
                    <span class="icon-label">FED</span>
                </div>
                <div class="icon-container Government-container">
                    <img src="https://raw.githubusercontent.com/yoon-seok/images/main/government.png" class="icon" alt="Government">
                    <span class="icon-label">Government</span>
                </div>
                <div class="icon-container Market-container">
                    <img src="https://raw.githubusercontent.com/yoon-seok/images/main/market.png" class="icon" alt="Market">
                    <span class="icon-label">Market</span>
                </div>
                <div class="icon-container MMF-container">
                    <img src="https://raw.githubusercontent.com/yoon-seok/images/main/mmf.png" class="icon" alt="MMF">
                    <span class="icon-label">MMF</span>
                </div>
                
                <div id="tgaSlopeDisplay" class="slope-positive"></div>
                <div id="fedLiquidityDisplay" class="slope-positive"></div>
                <div id="mmfToRrpDisplay" class="slope-positive"></div>
                <div id="mmfToMarketDisplay" class="slope-positive"></div>
                <div id="mmfToGovernmentDisplay" class="slope-positive"></div>
            </div>

            <div id="graphIndicators">
                <div class="indicator-section">
                    <h3>미국 재무부 계정 잔고(TGA)</h3>
                    <div class="indicator-buttons">
                        <button class="button" onclick="showGraph('TGA.csv', 'TGA', 'TGA 잔고(B$)', 'rgb(255, 99, 132)')">TGA 잔고</button>
                    </div>
                </div>
                <div class="indicator-section">
                    <h3>연준 유동성</h3>
                    <div class="indicator-buttons">
                        <button class="button" onclick="showGraph('BALANCE_SHEET_ASSETS.csv', 'Fed', '자산(B$)', 'rgb(54, 162, 235)')">대차대조표</button>
                        <button class="button" onclick="showGraph('RRP_OPERATIONS.csv', 'RRP', 'RRP 규모(B$)', 'rgb(255, 206, 86)')">RRP 규모</button>
                        <button class="button" onclick="showGraph('BTFP_FACILITY.csv', 'BTFP', 'BTFP 규모(B$)', 'rgb(75, 192, 192)')">BTFP 규모</button>
                    </div>
                </div>
                <div class="indicator-section">
                    <h3>MMF 자금 조달</h3>
                    <div class="indicator-buttons">
                        <button class="button" onclick="showGraph('MMF2GOVERNMENT.csv', 'MMF to Gov', '자금조달 규모(B$)', 'rgb(153, 102, 255)')">MMF to Gov</button>
                        <button class="button" onclick="showGraph('MMF2RRP.csv', 'MMF to RRP', '자금조달 규모(B$)', 'rgb(255, 159, 64)')">MMF to RRP</button>
                        <button class="button" onclick="showGraph('MMF2MARKET.csv', 'MMF to Market', '자금조달 규모(B$)', 'rgb(255, 99, 255)')">MMF to Market</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="graphPage" style="display:none;">
            <button class="back-btn" onclick="showMainPage()"></button>
            <h2 id="graphTitle"></h2>
            <div class="time-buttons">
                <button class="time-btn" onclick="setGraphTimeframe('1y')">1년</button>
                <button class="time-btn" onclick="setGraphTimeframe('3y')">3년</button>
                <button class="time-btn" onclick="setGraphTimeframe('5y')">5년</button>
                <button class="time-btn" onclick="setGraphTimeframe('all')">전체</button>
            </div>
            <canvas id="myChart"></canvas>
        </div>
        
        <div id="infoPage" style="display:none;">
            <button class="back-btn" onclick="showMainPage()"></button>
            <h2>정보 페이지</h2>
            <p>이 페이지는 미국 금융 시장의 유동성 현황을 시각화합니다.</p>
        </div>
    </div>
    
    <div class="nav-bar">
        <button class="button" onclick="showPage('mainPage')">유동성 현황</button>
        <button class="button" onclick="showPage('graphIndicators')">그래프 지표</button>
        <button class="button" onclick="showPage('infoPage')">정보</button>
    </div>

    <script>
        const liquidityFlow = document.getElementById('liquidityFlow');
        const mainPage = document.getElementById('mainPage');
        const graphPage = document.getElementById('graphPage');
        const infoPage = document.getElementById('infoPage');
        const navBar = document.querySelector('.nav-bar');
        const myChart = new Chart(document.getElementById('myChart').getContext('2d'), {
            type: 'line',
            data: {
                datasets: []
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                    },
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'month',
                            tooltipFormat: 'yyyy-MM-dd',
                        },
                        title: {
                            display: true,
                            text: '날짜',
                        },
                        min: null,
                        max: null,
                    },
                    y: {
                        title: {
                            display: true,
                            text: '값',
                        },
                        beginAtZero: false,
                    }
                },
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
            }
        });

        let currentGraphData = [];
        let currentGraphCSV = '';
        let currentGraphType = '';
        let currentGraphLabel = '';
        let currentGraphColor = '';

        myChart.canvas.addEventListener('wheel', function(event) {
            event.preventDefault();

            const chartArea = myChart.chartArea;
            if (event.offsetX < chartArea.left || event.offsetX > chartArea.right || event.offsetY < chartArea.top || event.offsetY > chartArea.bottom) {
                return;
            }

            const x_scale = myChart.options.scales.x;
            if (!x_scale || typeof x_scale.max === 'undefined' || typeof x_scale.min === 'undefined') {
                return;
            }

            const mouseX = event.offsetX;
            const dataX = x_scale.getValueForPixel(mouseX);
            
            const zoomFactor = 1.1;
            let newMin, newMax;

            if (event.deltaY < 0) {
                newMin = dataX - (dataX - x_scale.min) / zoomFactor;
                newMax = dataX + (x_scale.max - dataX) / zoomFactor;
            } else {
                newMin = dataX - (dataX - x_scale.min) * zoomFactor;
                newMax = dataX + (x_scale.max - dataX) * zoomFactor;
            }

            const allDates = currentGraphData.map(d => new Date(d.date).getTime());
            const minAllowedDate = Math.min(...allDates);
            const maxAllowedDate = Math.max(...allDates);

            if (newMin < minAllowedDate) newMin = minAllowedDate;
            if (newMax > maxAllowedDate) newMax = maxAllowedDate;
            if (newMin >= newMax) return; // Prevent zooming in too far
            
            myChart.options.scales.x.min = newMin;
            myChart.options.scales.x.max = newMax;
            myChart.update('none');
        });

        function showPage(pageId) {
            mainPage.style.display = 'none';
            graphPage.style.display = 'none';
            infoPage.style.display = 'none';
            document.getElementById('graphIndicators').style.display = 'none';

            if (pageId === 'graphIndicators') {
                document.getElementById('graphIndicators').style.display = 'block';
            } else {
                document.getElementById(pageId).style.display = 'block';
            }
        }

        function showMainPage() {
            showPage('mainPage');
        }

        function showGraphPage() {
            showPage('graphPage');
        }

        function parseCSV(csvText) {
            return Papa.parse(csvText, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true
            }).data;
        }

        async function fetchAndProcessData() {
            try {
                // TGA 데이터 처리
                const tgaResponse = await fetch('TGA.csv');
                const tgaText = await tgaResponse.text();
                const tgaData = parseCSV(tgaText);
                processTGAData(tgaData);

                // MMF to Government 데이터 처리
                const mmfToGovernmentResponse = await fetch('MMF2GOVERNMENT.csv');
                const mmfToGovernmentText = await mmfToGovernmentResponse.text();
                const mmfToGovernmentData = parseCSV(mmfToGovernmentText);
                processMmfToGovernment(mmfToGovernmentData);
                
                // MMF to RRP 데이터 처리
                const mmfToRrpResponse = await fetch('MMF2RRP.csv');
                const mmfToRrpText = await mmfToRrpResponse.text();
                const mmfToRrpData = parseCSV(mmfToRrpText);
                processMmfToRrp(mmfToRrpData);

                // MMF to Market 데이터 처리
                const mmfToMarketResponse = await fetch('MMF2MARKET.csv');
                const mmfToMarketText = await mmfToMarketResponse.text();
                const mmfToMarketData = parseCSV(mmfToMarketText);
                processMmfToMarket(mmfToMarketData);

            } catch (error) {
                console.error('Failed to fetch data:', error);
            }
        }

        function processTGAData(data) {
            if (data.length < 30) return;

            const latestDate = data[data.length - 1];
            const oneMonthAgoDate = data[data.length - 30];
            const c = latestDate.value - oneMonthAgoDate.value;

            const tgaSlopeDisplay = document.getElementById('tgaSlopeDisplay');
            const formattedC = (c / 1000).toFixed(2);
            tgaSlopeDisplay.textContent = `TGA 잔고 변화: ${formattedC} B$/Month`;
            tgaSlopeDisplay.className = c >= 0 ? 'slope-positive' : 'slope-negative';

            // 애니메이션
            const startIcon = c >= 0 ? 'Market' : 'Government';
            const endIcon = c >= 0 ? 'Government' : 'Market';
            const animationClass = c >= 0 ? 'animated-dollar-to-government' : 'animated-dollar-from-government';

            createDollarAnimation(animationClass, 6000, 3000);
        }

        function processMmfToGovernment(data) {
            if (data.length < 30) return;

            const latestDate = data[data.length - 1];
            const oneMonthAgoDate = data[data.length - 30];
            const c = latestDate.value - oneMonthAgoDate.value;

            const mmfToGovernmentDisplay = document.getElementById('mmfToGovernmentDisplay');
            const formattedC = (c / 1000).toFixed(2);
            mmfToGovernmentDisplay.textContent = `MMF 현금 조달 : ${formattedC} B$/Month`;
            mmfToGovernmentDisplay.className = c >= 0 ? 'slope-positive' : 'slope-negative';
            
            // 애니메이션
            const animationClass = c >= 0 ? 'animated-dollar-from-mmf-to-government' : 'animated-dollar-from-government-to-mmf';
            createDollarAnimation(animationClass, 6000, 3000);
        }
        
        function processMmfToRrp(data) {
            if (data.length < 30) return;

            const latestDate = data[data.length - 1];
            const oneMonthAgoDate = data[data.length - 30];
            const c = latestDate.value - oneMonthAgoDate.value;

            const mmfToRrpDisplay = document.getElementById('mmfToRrpDisplay');
            const formattedC = (c / 1000).toFixed(2);
            mmfToRrpDisplay.textContent = `RRP 현금 조달 : ${formattedC} B$/Month`;
            mmfToRrpDisplay.className = c >= 0 ? 'slope-positive' : 'slope-negative';

            // 애니메이션
            const animationClass = c >= 0 ? 'animated-dollar-from-mmf-to-fed' : 'animated-dollar-from-fed-to-mmf';
            createDollarAnimation(animationClass, 6000, 3000);
        }

        function processMmfToMarket(data) {
            if (data.length < 30) return;

            const latestDate = data[data.length - 1];
            const oneMonthAgoDate = data[data.length - 30];
            const c = latestDate.value - oneMonthAgoDate.value;

            const mmfToMarketDisplay = document.getElementById('mmfToMarketDisplay');
            const formattedC = (c / 1000).toFixed(2);
            mmfToMarketDisplay.textContent = `Market 현금 조달 : ${formattedC} B$/Month`;
            mmfToMarketDisplay.className = c >= 0 ? 'slope-positive' : 'slope-negative';

            // 애니메이션
            const animationClass = c >= 0 ? 'animated-dollar-from-mmf-to-market' : 'animated-dollar-from-market-to-mmf';
            createDollarAnimation(animationClass, 6000, 3000);
        }

        function createDollarAnimation(animationClass, duration, interval) {
            const dollarIconSrc = "https://raw.githubusercontent.com/yoon-seok/images/main/dollar.gif";
            let dollarObject = document.createElement('img');
            dollarObject.src = dollarIconSrc;
            dollarObject.className = 'dollar-animated-object';

            liquidityFlow.appendChild(dollarObject);
            
            let animationDuration = duration;
            let animationInterval = interval;
            
            const animate = () => {
                dollarObject.style.animation = ``;
                setTimeout(() => {
                    dollarObject.style.setProperty('--animation-duration', `${animationDuration}ms`);
                    dollarObject.classList.add(animationClass);
                }, 10);
            };

            const animateLoop = () => {
                animate();
                setTimeout(() => {
                    dollarObject.classList.remove(animationClass);
                    animateLoop();
                }, animationDuration + animationInterval);
            };

            animateLoop();
        }

        async function showGraph(csvFile, graphType, labelText, color) {
            const response = await fetch(csvFile);
            const csvText = await response.text();
            currentGraphData = parseCSV(csvText);
            currentGraphCSV = csvFile;
            currentGraphType = graphType;
            currentGraphLabel = labelText;
            currentGraphColor = color;
            
            document.getElementById('graphTitle').textContent = `${currentGraphLabel} (${currentGraphType})`;

            updateChart(currentGraphData, currentGraphLabel, currentGraphColor);
            showGraphPage();
        }

        function updateChart(data, label, color) {
            const dates = data.map(row => new Date(row.date));
            const values = data.map(row => row.value);
            const datasets = [{
                label: label,
                data: values.map((val, i) => ({ x: dates[i], y: val })),
                borderColor: color,
                backgroundColor: color,
                borderWidth: 2,
                pointRadius: 0,
                tension: 0.1,
                fill: false
            }];

            myChart.data.datasets = datasets;
            myChart.update();
        }

        function setGraphTimeframe(timeframe) {
            const allDates = currentGraphData.map(d => new Date(d.date).getTime());
            if (allDates.length === 0) return;

            const maxDate = Math.max(...allDates);
            let minDate;

            switch(timeframe) {
                case '1y':
                    minDate = new Date(maxDate);
                    minDate.setFullYear(minDate.getFullYear() - 1);
                    break;
                case '3y':
                    minDate = new Date(maxDate);
                    minDate.setFullYear(minDate.getFullYear() - 3);
                    break;
                case '5y':
                    minDate = new Date(maxDate);
                    minDate.setFullYear(minDate.getFullYear() - 5);
                    break;
                case 'all':
                default:
                    minDate = Math.min(...allDates);
                    break;
            }
            
            myChart.options.scales.x.min = minDate;
            myChart.options.scales.x.max = maxDate;
            myChart.update('none');
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchAndProcessData();
            showPage('mainPage');
        });
    </script>
</body>
</html>